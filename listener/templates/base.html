{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://kit.fontawesome.com/eb75260fb3.js" crossorigin="anonymous"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@9/swiper-bundle.min.css" />
  <link rel="stylesheet"
    href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,300,0,0" />
  <script src="https://cdn.jsdelivr.net/npm/swiper@9/swiper-bundle.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"
    integrity="sha512-z4OUqw38qNLpn1libAN9BsoDx6nbNFio5lA6CuTp9NlK83b89hgyCVq+N5FdBJptINztxn1Z3SaKSKUS5UP60Q=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.4.0/axios.min.js"
    integrity="sha512-uMtXmF28A2Ab/JJO2t/vYhlaa/3ahUOgj1Zf27M5rOo8/+fcTUVH0/E0ll68njmjrLqOBjXM3V9NiPFL5ywWPQ=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <title>OBUOBA RADIO</title>
  <link rel="stylesheet" href="{% static 'base.css' %}">
  {% block css %}

  {% endblock css %}

  <script>
    const setMaxHeight = () => {
      const vh = window.innerHeight * 0.01;
      document.documentElement.style.setProperty('--vh', `${vh}px`);
    }
    setMaxHeight();

    window.addEventListener('resize', setMaxHeight);
  </script>
</head>

<body>
  <a href="{% url 'homepage' %}" class="mobile_nav">
    <img src="https://res.cloudinary.com/dvnemzw0z/image/upload/v1692289104/logo_2_nxwecd.png" alt="">
    <span>OBUOBA FM</span>
  </a>

  <section class="top_nav">
    <button class="material-symbols-outlined" style="cursor: pointer;" onclick="toggleSideBar()">menu</button>
    <div class="left">
      <small>Follow Us On</small>
      <hr style="width: 80px; border-top: 2px solid darkgray;">
      <div>
        <a class="fa-brands fa-instagram"></a>
        <a class="fa-brands fa-facebook"></a>
        <a class="fa-brands fa-twitter"></a>
        <a class="fa-brands fa-tiktok"></a>
      </div>
    </div>

    <div class="player">
      <p>
        <span>{{program.name}}</span>
        <small>{{program.start_date|date:'G:i'}} - {{program.end_date|date:'G:i'}}</small>
      </p>
      <button class="material-symbols-outlined">play_arrow</button>
    </div>
    <div class="right">
      <input type="text" placeholder="Search">
      <i class="material-symbols-outlined">search</i>
    </div>
  </section>

  <section class="page">
    {% include "sideBar.html" %}

    <section class="main">
      {% block main %}

      {% endblock main %}

      <section class="loader" tabindex="0">
        <div></div>
        <div></div>
        <div></div>
      </section>
    </section>
    {% include "panel.html" %}
  </section>

  <script>
    if (window.history.replaceState) {
      window.history.replaceState(null, null, window.location.href)
    }

    const loader = document.querySelector('.loader')
    const loaderAnime =
      anime({
        begin: () => {
          loader.style.display = 'flex';
        },
        loop: true,
        targets: '.loader div',
        opacity: [0, 1],
        scale: [0.2, 1],
      })

    loaderAnime.pause()

    const runAxios = (url, data) => {
      axios.post(`${window.location.origin}/${url}`, {
        data: data
      },
        { headers: { 'X-CSRFToken': '{{token}}' } }
      )
        .then(response => handleData(response.data))
        .catch(error => console.log(error))
    }

    getTimeLeft = (target_date) => {
      var new_today = new Date()
      var timeLeft = target_date - new_today;
      var daysLeft = Math.floor(timeLeft / (1000 * 60 * 60 * 24));
      if (daysLeft < 10) {
        daysLeft = `0${daysLeft}`
      }
      var hoursLeft = Math.floor((timeLeft % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
      if (hoursLeft < 10) {
        hoursLeft = `0${hoursLeft}`
      }
      var minutesLeft = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
      if (minutesLeft < 10) {
        minutesLeft = `0${minutesLeft}`
      }
      var secondsLeft = Math.floor((timeLeft % (1000 * 60)) / 1000);
      if (secondsLeft < 10) {
        secondsLeft = `0${secondsLeft}`
      }

      let countdown = ''
      if (timeLeft > 0) {
        if (daysLeft > 0) {
          countdown = `${daysLeft} : ${hoursLeft} : ${minutesLeft} : ${secondsLeft}`
        } else {
          countdown = `${hoursLeft} : ${minutesLeft} : ${secondsLeft}`
        }
      } else {
        countdown = '00:00'
      }

      return countdown
    }
  </script>
  <script>
    var today = new Date()
    var program_start_date = new Date('{{program.start_date|date:"c"}}')
    var program_end_date = new Date('{{program.end_date|date:"c"}}')
    const cur_tags = document.querySelectorAll('.cur_tag')

    if (today > program_end_date) {
      runAxios('schedule_program', '{{program.id}}')
    } else if (today >= program_start_date && program_end_date >= today) {
      cur_tags.forEach((el) => {
        el.innerHTML = 'On Air'
      })
    } else if (program_start_date > today) {
      setInterval(() => {
        cur_tags.forEach((el) => {
          el.innerHTML = getTimeLeft(program_start_date)
        })
      }, 500)
    }
  </script>
  {% block js %}

  {% endblock js %}
</body>

</html>